<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Galaxy Sport - Catálogo de Pedidos 2.0</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- AOS (Animate On Scroll) -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap"
      rel="stylesheet"
    />

    <!-- Ionicons -->
    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <style>
      :root {
        --bg-dark: #121212;
        --bg-light: #1e1e1e;
        --primary: #c44957;
        --secondary: #f5c518;
        --text-light: #f3f4f6;
        --text-dark: #a0aec0;
      }
      body {
        font-family: "Poppins", sans-serif;
        background-color: var(--bg-dark);
        color: var(--text-light);
      }
      .nav-scrolled {
        background-color: rgba(18, 18, 18, 0.85);
        backdrop-filter: blur(12px);
      }
      .text-gradient {
        background: linear-gradient(90deg, var(--secondary), var(--primary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .modal {
        transition: opacity 0.3s ease-in-out;
      }
      .modal-content {
        transition: transform 0.3s ease-in-out;
      }
      .category-btn {
        transition: all 0.2s ease-in-out;
        background-color: var(--bg-light);
      }
      .category-btn.active,
      .category-btn:hover {
        background-color: var(--primary);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(196, 73, 87, 0.3);
      }

      .talla-radio-input {
        display: none;
      }
      .talla-radio-label {
        display: inline-block;
        padding: 0.5rem 1rem;
        border: 2px solid #4a4a4a;
        border-radius: 0.5rem;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s ease-in-out;
      }
      .talla-radio-label:hover {
        border-color: var(--secondary);
        color: var(--secondary);
      }
      .talla-radio-input:checked + .talla-radio-label {
        background-color: var(--primary);
        border-color: var(--primary);
        color: white;
        transform: scale(1.05);
      }

      /* Estilos para la notificación Toast */
      #toast-notification {
        transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
      }

      /* Animación para el contador del carrito */
      @keyframes pop {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.3);
        }
        100% {
          transform: scale(1);
        }
      }
      .cart-pop {
        animation: pop 0.3s ease-in-out;
      }

      /* Estilos para el botón de volver arriba */
      #back-to-top-btn {
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        transform: translateY(20px);
      }
      #back-to-top-btn.show {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0);
      }
    </style>
  </head>

  <body class="antialiased">
    <!-- NAVBAR -->
    <header
      id="header"
      class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-black/50 backdrop-blur-sm"
    >
      <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
        <a
          href="#"
          class="flex items-center space-x-3 text-2xl font-bold text-white tracking-wider"
        >
          <img
            src="assets/img/logo.jpg"
            alt="Galaxy Sport Logo"
            class="h-10 w-10 rounded-full border-2 border-[var(--secondary)]"
          />
          <span>GALAXY <span class="text-[var(--primary)]">SPORT</span></span>
        </a>
        <button
          id="open-cart-button"
          class="relative hover:text-[var(--secondary)] transition-colors duration-300"
        >
          <ion-icon name="cart-outline" class="text-3xl"></ion-icon>
          <span
            id="cart-counter"
            class="absolute -top-2 -right-2 bg-[var(--primary)] text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold"
            >0</span
          >
        </button>
      </nav>
    </header>

    <main>
      <!-- HERO -->
      <section
        id="home"
        class="relative h-[85vh] md:h-[95vh] flex items-center justify-center text-center overflow-hidden"
      >
        <img
          src="assets/img/hero.gif"
          alt="Fondo animado de camisetas de fútbol"
          class="absolute inset-0 w-full h-full object-cover filter brightness-50"
        />

        <div
          class="absolute inset-0 bg-gradient-to-t from-[var(--bg-dark)] via-transparent to-transparent"
        ></div>
        <div class="relative z-10 container mx-auto px-6" data-aos="fade-up">
          <h1
            class="text-4xl md:text-6xl lg:text-7xl font-black uppercase text-white tracking-wider leading-tight"
          >
            Viste la pasión <br />
            <span class="text-gradient">de tu equipo</span>
          </h1>
          <p class="mt-4 text-lg md:text-xl text-gray-300 max-w-2xl mx-auto">
            Selecciona tus camisetas favoritas y finaliza tu pedido directamente por WhatsApp.
          </p>
          <a
            href="#catalog"
            class="mt-8 inline-block bg-[var(--primary)] text-white font-bold py-3 px-8 rounded-full text-lg hover:opacity-90 transition-all transform hover:-translate-y-1 shadow-lg shadow-[var(--primary)/30%] hover:shadow-[var(--primary)/50%]"
          >
            Ver Catálogo
          </a>
        </div>
      </section>

      <!-- CATÁLOGO -->
      <section id="catalog" class="py-24">
        <div class="container mx-auto px-6">
          <div class="text-center mb-10" data-aos="fade-up">
            <h2 class="text-4xl md:text-5xl font-bold">
              Nuestro <span class="text-gradient">Catálogo</span>
            </h2>
            <p class="text-lg text-gray-400 mt-2">Novedades y clásicos inolvidables.</p>
          </div>

          <!-- Barra de Búsqueda -->
          <div class="max-w-xl mx-auto mb-12" data-aos="fade-up">
            <div class="relative">
              <input
                type="text"
                id="search-input"
                placeholder="Buscar por equipo, liga, jugador..."
                class="w-full bg-[var(--bg-light)] border-2 border-gray-700 rounded-full py-3 pl-6 pr-14 text-white placeholder-gray-500 focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] transition-all"
              />
              <div class="absolute inset-y-0 right-0 flex items-center pr-5">
                <ion-icon name="search-outline" class="text-gray-500 text-2xl"></ion-icon>
              </div>
            </div>
          </div>

          <div
            id="category-filters"
            class="flex flex-wrap justify-center gap-3 md:gap-4 mb-12"
            data-aos="fade-up"
          >
            <!-- Las categorías se generarán con JS -->
          </div>
          <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8"></div>
        </div>
      </section>
    </main>

    <!-- FOOTER -->
    <footer id="contact" class="bg-[#0D0D0D] pt-16 pb-8">
      <div class="container mx-auto px-6 text-center">
        <a
          href="#"
          class="flex items-center justify-center space-x-3 text-2xl font-bold text-white tracking-wider"
        >
          <img
            src="assets/img/logo.jpg"
            alt="Galaxy Sport Logo"
            class="h-10 w-10 rounded-full border-2 border-[var(--secondary)]"
          />
          <span>GALAXY <span class="text-[var(--primary)]">SPORT</span></span>
        </a>
        <p class="text-[var(--text-dark)] mt-4 max-w-md mx-auto">
          Tu pasión, nuestra misión. Ofreciendo las mejores camisetas de fútbol con calidad
          garantizada.
        </p>

        <!-- Íconos de redes sociales -->
        <div class="flex justify-center space-x-6 mt-6">
          <a href="#" class="text-gray-500 hover:text-[var(--primary)] transition-colors text-3xl"
            ><ion-icon name="logo-instagram"></ion-icon
          ></a>
          <a href="#" class="text-gray-500 hover:text-[var(--primary)] transition-colors text-3xl"
            ><ion-icon name="logo-facebook"></ion-icon
          ></a>
          <a href="#" class="text-gray-500 hover:text-[var(--primary)] transition-colors text-3xl"
            ><ion-icon name="logo-tiktok"></ion-icon
          ></a>
        </div>

        <hr class="border-gray-800 my-8" />
        <p class="text-center text-gray-600">
          &copy; 2024 Galaxy Sport. Todos los derechos reservados.
        </p>
      </div>
    </footer>

    <!-- MODAL DEL CARRITO -->
    <div
      id="cart-modal"
      class="modal fixed inset-0 z-[60] flex items-center justify-center bg-black/70 backdrop-blur-sm opacity-0 pointer-events-none"
    >
      <div
        id="cart-modal-content"
        class="modal-content bg-[var(--bg-light)] w-full max-w-lg rounded-xl shadow-2xl m-4 transform scale-95"
      >
        <div class="flex justify-between items-center p-5 border-b border-gray-700">
          <h3 class="text-2xl font-bold">Tu Pedido</h3>
          <button
            id="close-cart-button"
            class="text-3xl hover:text-[var(--primary)] transition-colors"
          >
            &times;
          </button>
        </div>
        <div id="cart-items" class="p-5 max-h-[40vh] overflow-y-auto"></div>
        <div class="p-5 border-t border-gray-700">
          <div class="flex justify-between items-center mb-4 text-xl">
            <span class="font-semibold">Total:</span>
            <span id="cart-total" class="font-bold text-[var(--secondary)]">$0.00</span>
          </div>
          <button
            id="whatsapp-button"
            class="w-full bg-green-500 text-white font-bold py-3 px-6 rounded-lg text-lg flex items-center justify-center gap-3 hover:bg-green-600 transition-colors disabled:bg-gray-500 disabled:cursor-not-allowed"
          >
            <ion-icon name="logo-whatsapp" class="text-2xl"></ion-icon>
            Confirmar Pedido por WhatsApp
          </button>
        </div>
      </div>
    </div>

    <!-- MODAL DE OPCIONES DE PRODUCTO -->
    <div
      id="options-modal"
      class="modal fixed inset-0 z-[70] flex items-center justify-center bg-black/70 backdrop-blur-sm opacity-0 pointer-events-none"
    >
      <div
        id="options-modal-content"
        class="modal-content bg-[var(--bg-light)] w-full max-w-2xl rounded-2xl shadow-2xl m-4 transform scale-95 flex flex-col max-h-[95vh]"
      >
        <div class="flex justify-between items-center p-5 border-b border-gray-800 flex-shrink-0">
          <h3 id="options-title" class="text-xl font-semibold">Elige tus Opciones</h3>
          <button
            id="close-options-button"
            class="text-gray-500 hover:text-[var(--primary)] transition-colors text-2xl"
          >
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>

        <div class="p-6 overflow-y-auto">
          <div class="grid grid-cols-1 md:grid-cols-2 md:gap-8">
            <div class="mb-6 md:mb-0">
              <img
                id="options-image"
                src=""
                alt="Producto"
                class="w-full h-auto object-cover rounded-xl shadow-lg mb-4"
              />
              <div id="options-gallery" class="flex justify-center gap-3"></div>
            </div>

            <div>
              <form id="options-form" class="flex flex-col h-full">
                <div class="mb-5">
                  <label class="block mb-3 font-semibold text-md">Talla:</label>
                  <div id="talla-selector-container" class="flex flex-wrap gap-3"></div>
                </div>

                <div id="personalizacion-fields" class="hidden">
                  <div class="border-t border-gray-800 pt-5 mt-5">
                    <h4 class="font-semibold text-md mb-3">
                      Personalización
                      <span class="text-xs text-[var(--primary)] font-bold">(+ $5.00)</span>
                    </h4>
                    <div class="mb-4">
                      <label for="player-name" class="block mb-2 font-medium text-sm text-gray-400"
                        >Nombre:</label
                      >
                      <input
                        type="text"
                        id="player-name"
                        placeholder="Ej: MBAPPÉ"
                        class="w-full bg-[#2a2a2a] border-2 border-gray-700 rounded-lg p-2.5 focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] transition-all"
                      />
                    </div>
                    <div>
                      <label
                        for="player-number"
                        class="block mb-2 font-medium text-sm text-gray-400"
                        >Número:</label
                      >
                      <input
                        type="number"
                        id="player-number"
                        placeholder="Ej: 7"
                        class="w-full bg-[#2a2a2a] border-2 border-gray-700 rounded-lg p-2.5 focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] transition-all"
                      />
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div class="p-5 mt-auto border-t border-gray-800 flex-shrink-0">
          <button
            type="submit"
            form="options-form"
            id="add-from-options-btn"
            class="w-full bg-[var(--primary)] text-white font-bold py-3 px-6 rounded-xl text-lg flex items-center justify-center gap-3 hover:opacity-90 transition-all transform hover:-translate-y-1 shadow-lg shadow-[var(--primary)/30%] hover:shadow-[var(--primary)/50%]"
          >
            <ion-icon name="add-circle-outline" class="text-2xl"></ion-icon>
            Añadir al Pedido
          </button>
        </div>
      </div>
    </div>

    <!-- Contenedor para notificaciones Toast -->
    <div
      id="toast-notification"
      class="fixed bottom-5 right-5 z-[100] bg-green-500 text-white py-3 px-6 rounded-lg shadow-lg flex items-center gap-3 transform translate-y-20 opacity-0 pointer-events-none"
    >
      <ion-icon name="checkmark-circle-outline" class="text-2xl"></ion-icon>
      <span id="toast-message"></span>
    </div>

    <!-- Botón para volver arriba -->
    <button
      id="back-to-top-btn"
      class="fixed bottom-8 right-8 z-[55] bg-[var(--primary)] text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:opacity-80 transition-all opacity-0 pointer-events-none"
    >
      <ion-icon name="arrow-up-outline" class="text-2xl"></ion-icon>
    </button>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // CORRECCIÓN: Se mueven los datos de los productos aquí para evitar errores de carga.
        const productos = [
          {
            id: 1,
            nombre: "FC Barcelona 23/24",
            descripcion: "Versión Jugador",
            precio: 25.0,
            imagen: "assets/img/85673b79.jpg",
            galeria: [
              "assets/img/85673b79.jpg",
              "assets/img/709c2bfa.jpg",
              "assets/img/926c281f.jpg",
            ],
            categoria: "europa",
            personalizable: true,
            costoPersonalizacion: 5.0,
            tallas: ["S", "M", "L", "XL"],
            nuevo: true,
            tags: ["barcelona", "barça", "la liga", "españa"],
          },
          {
            id: 2,
            nombre: "Juventus FC 23/24",
            descripcion: "Versión Visitante",
            precio: 25.0,
            imagen: "assets/img/15d72690.jpg",
            galeria: ["assets/img/15d72690.jpg"],
            categoria: "europa",
            personalizable: false,
            tallas: ["M", "L"],
            nuevo: false,
            tags: ["juventus", "juve", "serie a", "italia"],
          },
          {
            id: 3,
            nombre: "Villarreal CF 23/24",
            descripcion: "Versión Local",
            precio: 25.0,
            imagen: "assets/img/3de3ba71.jpg",
            galeria: ["assets/img/3de3ba71.jpg"],
            categoria: "europa",
            personalizable: true,
            costoPersonalizacion: 5.0,
            tallas: ["S", "M", "L", "XL"],
            nuevo: false,
            tags: ["villarreal", "la liga", "españa"],
          },
          {
            id: 4,
            nombre: "Real Madrid 23/24",
            descripcion: "Tercera Equipación",
            precio: 25.0,
            imagen: "assets/img/610cc7ed.jpg",
            galeria: [
              "assets/img/610cc7ed.jpg",
              "https://placehold.co/400x400/1E1E1E/f3f4f6?text=Dorso",
            ],
            categoria: "europa",
            personalizable: true,
            costoPersonalizacion: 5.0,
            tallas: ["S", "M", "L", "XL"],
            nuevo: false,
            tags: ["real madrid", "halamadrid", "la liga", "españa"],
          },
          {
            id: 5,
            nombre: "Atlético Madrid 23/24",
            descripcion: "BARRIOS #8",
            precio: 30.0,
            imagen: "assets/img/964e2175.jpg",
            galeria: ["assets/img/964e2175.jpg"],
            categoria: "europa",
            personalizable: false,
            tallas: ["L"],
            nuevo: true,
            tags: ["atletico madrid", "atleti", "barrios", "la liga"],
          },
          {
            id: 6,
            nombre: "Borussia Dortmund 22/23",
            descripcion: "Versión Local",
            precio: 25.0,
            imagen: "assets/img/32ed28d1.jpg",
            galeria: ["assets/img/32ed28d1.jpg"],
            categoria: "europa",
            personalizable: true,
            costoPersonalizacion: 5.0,
            tallas: ["S", "M", "L"],
            nuevo: false,
            tags: ["borussia", "dortmund", "bvb", "bundesliga", "alemania"],
          },
          {
            id: 7,
            nombre: "Paris Saint-Germain 22/23",
            descripcion: "Versión Visitante",
            precio: 25.0,
            imagen: "assets/img/daba8c04.jpg",
            galeria: ["assets/img/daba8c04.jpg"],
            categoria: "europa",
            personalizable: true,
            costoPersonalizacion: 5.0,
            tallas: ["S", "M", "L", "XL"],
            nuevo: false,
            tags: ["psg", "paris", "ligue 1", "francia", "mbappe"],
          },
        ];

        // =================================================================
        // ===== 1. CONFIGURACIÓN ==========================================
        // =================================================================

        const tuNumeroDeWhatsApp = "584121234567";

        // =================================================================
        // ===== FIN DE LA CONFIGURACIÓN ===================================
        // =================================================================

        let carrito = [];
        const productGrid = document.getElementById("product-grid");
        const categoryFilters = document.getElementById("category-filters");
        const searchInput = document.getElementById("search-input");

        const openCartButton = document.getElementById("open-cart-button");
        const closeCartButton = document.getElementById("close-cart-button");
        const cartModal = document.getElementById("cart-modal");
        const cartItemsContainer = document.getElementById("cart-items");
        const cartCounter = document.getElementById("cart-counter");
        const cartTotal = document.getElementById("cart-total");
        const whatsappButton = document.getElementById("whatsapp-button");

        const optionsModal = document.getElementById("options-modal");
        const closeOptionsButton = document.getElementById("close-options-button");
        const optionsForm = document.getElementById("options-form");
        const optionsTitle = document.getElementById("options-title");
        const optionsImage = document.getElementById("options-image");
        const optionsGallery = document.getElementById("options-gallery");
        const personalizacionFields = document.getElementById("personalizacion-fields");
        const playerNameInput = document.getElementById("player-name");
        const playerNumberInput = document.getElementById("player-number");

        const toast = document.getElementById("toast-notification");
        const toastMessage = document.getElementById("toast-message");
        const header = document.getElementById("header");
        const backToTopButton = document.getElementById("back-to-top-btn");

        // --- MANEJADORES DE EVENTOS GLOBALES ---

        window.addEventListener("scroll", () => {
          // Efecto de scroll en la barra de navegación
          if (window.scrollY > 50) {
            header.classList.add("nav-scrolled");
          } else {
            header.classList.remove("nav-scrolled");
          }

          // Mostrar/ocultar botón de volver arriba
          if (window.scrollY > 400) {
            backToTopButton.classList.add("show");
          } else {
            backToTopButton.classList.remove("show");
          }
        });

        // Evento click para el botón de volver arriba
        backToTopButton.addEventListener("click", () => {
          window.scrollTo({
            top: 0,
            behavior: "smooth",
          });
        });

        // --- FUNCIONES DE LA APLICACIÓN ---

        function cargarCarritoDesdeStorage() {
          const carritoGuardado = localStorage.getItem("galaxySportCart");
          if (carritoGuardado) {
            carrito = JSON.parse(carritoGuardado);
            actualizarCarrito();
          }
        }

        function guardarCarritoEnStorage() {
          localStorage.setItem("galaxySportCart", JSON.stringify(carrito));
        }

        function mostrarToast(mensaje) {
          toastMessage.textContent = mensaje;
          toast.classList.remove("translate-y-20", "opacity-0");
          setTimeout(() => {
            toast.classList.add("translate-y-20", "opacity-0");
          }, 3000);
        }

        function renderizarFiltros() {
          const categorias = ["all", ...new Set(productos.map((p) => p.categoria))];
          categoryFilters.innerHTML = "";
          categorias.forEach((cat) => {
            let nombreAmigable = cat.charAt(0).toUpperCase() + cat.slice(1).replace(/_/g, " ");
            if (cat === "all") nombreAmigable = "Todos";

            const button = document.createElement("button");
            button.className = "category-btn font-semibold py-2 px-5 rounded-full";
            button.textContent = nombreAmigable;
            button.dataset.category = cat;
            if (cat === "all") button.classList.add("active");
            categoryFilters.appendChild(button);
          });
        }

        function renderizarProductos(filtro = "all", busqueda = "") {
          productGrid.innerHTML = "";

          let productosFiltrados = productos;

          if (filtro !== "all") {
            productosFiltrados = productosFiltrados.filter((p) => p.categoria === filtro);
          }

          if (busqueda) {
            busqueda = busqueda.toLowerCase();
            productosFiltrados = productosFiltrados.filter(
              (p) =>
                p.nombre.toLowerCase().includes(busqueda) ||
                p.descripcion.toLowerCase().includes(busqueda) ||
                (p.tags && p.tags.some((tag) => tag.toLowerCase().includes(busqueda)))
            );
          }

          if (productosFiltrados.length === 0) {
            productGrid.innerHTML = `<p class="col-span-full text-center text-gray-400 text-lg">No se encontraron productos.</p>`;
            return;
          }

          productosFiltrados.forEach((producto) => {
            const productoHTML = `
                <div class="bg-[var(--bg-light)] rounded-xl overflow-hidden shadow-lg group transition-transform duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-[var(--primary)/20%]" data-aos="fade-up">
                    <div class="relative overflow-hidden">
                        ${
                          producto.nuevo
                            ? '<span class="absolute top-3 left-3 bg-[var(--secondary)] text-black text-xs font-bold px-3 py-1 rounded-full z-10">NUEVO</span>'
                            : ""
                        }
                        <img src="${producto.imagen}" alt="${
              producto.nombre
            }" loading="lazy" class="w-full h-80 object-cover transition-transform duration-500 group-hover:scale-110">
                        <div class="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <button class="open-options-btn text-white text-lg bg-[var(--primary)] py-2 px-6 rounded-full hover:bg-[var(--secondary)] hover:text-black font-semibold" data-id="${
                              producto.id
                            }">Añadir al Pedido</button>
                        </div>
                    </div>
                    <div class="p-5 text-center">
                        <h3 class="text-xl font-bold text-white">${producto.nombre}</h3>
                        <p class="text-[var(--text-dark)] mt-1">${producto.descripcion}</p>
                        <p class="text-2xl font-bold text-[var(--secondary)] mt-2">$${producto.precio.toFixed(
                          2
                        )}</p>
                    </div>
                </div>`;
            productGrid.innerHTML += productoHTML;
          });
          AOS.refresh();
        }

        function abrirModalOpciones(idProducto) {
          const producto = productos.find((p) => p.id === idProducto);
          if (!producto) return;

          optionsTitle.textContent = producto.nombre;
          optionsForm.dataset.productId = idProducto;

          optionsGallery.innerHTML = "";
          if (producto.galeria && producto.galeria.length > 0) {
            optionsImage.src = producto.galeria[0];
            producto.galeria.forEach((imgUrl, index) => {
              const thumb = document.createElement("img");
              thumb.src = imgUrl;
              thumb.alt = `Vista ${index + 1}`;
              thumb.className =
                "w-12 h-12 object-cover rounded-md cursor-pointer border-2 border-transparent hover:border-[var(--primary)] transition-all";
              thumb.classList.toggle("border-[var(--primary)]", index === 0);
              thumb.dataset.fullSrc = imgUrl;
              optionsGallery.appendChild(thumb);
            });
          } else {
            optionsImage.src = producto.imagen;
          }

          const tallaContainer = document.getElementById("talla-selector-container");
          tallaContainer.innerHTML = "";
          producto.tallas.forEach((talla, index) => {
            const isChecked = index === 0 ? "checked" : "";
            tallaContainer.innerHTML += `
              <div>
                <input type="radio" id="talla-${talla}-${producto.id}" name="talla" value="${talla}" class="talla-radio-input" ${isChecked}>
                <label for="talla-${talla}-${producto.id}" class="talla-radio-label">${talla}</label>
              </div>`;
          });

          if (producto.personalizable) {
            personalizacionFields.classList.remove("hidden");
          } else {
            personalizacionFields.classList.add("hidden");
          }

          playerNameInput.value = "";
          playerNumberInput.value = "";

          optionsModal.classList.remove("opacity-0", "pointer-events-none");
          document.getElementById("options-modal-content").classList.remove("scale-95");
        }

        function cerrarModalOpciones() {
          optionsModal.classList.add("opacity-0", "pointer-events-none");
          document.getElementById("options-modal-content").classList.add("scale-95");
        }

        function agregarAlCarrito(item) {
          carrito.push(item);
          actualizarCarrito();
          mostrarToast("¡Agregado al pedido!");
        }
        function quitarDelCarrito(cartItemId) {
          carrito = carrito.filter((item) => item.cartItemId !== cartItemId);
          actualizarCarrito();
          mostrarToast("Producto eliminado.");
        }
        function actualizarCarrito() {
          renderizarItemsCarrito();
          actualizarTotal();
          actualizarContadorCarrito();
          guardarCarritoEnStorage();
        }

        function renderizarItemsCarrito() {
          cartItemsContainer.innerHTML = "";
          if (carrito.length === 0) {
            cartItemsContainer.innerHTML = `<div class="text-center py-8">
                  <ion-icon name="sad-outline" class="text-6xl text-gray-600"></ion-icon>
                  <p class="text-gray-400 mt-2">Tu pedido está vacío.</p>
                  <button id="close-and-shop" class="mt-4 bg-[var(--primary)] text-white font-bold py-2 px-6 rounded-full text-md hover:opacity-90 transition-all">Empezar a comprar</button>
               </div>`;
            whatsappButton.disabled = true;
            return;
          }
          whatsappButton.disabled = false;
          carrito.forEach((item) => {
            let detalles = `Talla: ${item.talla}`;
            if (item.nombreJugador) {
              detalles += ` | ${item.nombreJugador} #${item.numeroJugador}`;
            }
            const itemHTML = `
                <div class="flex items-center justify-between gap-4 py-3">
                    <img src="${item.imagen}" alt="${
              item.nombre
            }" class="w-16 h-16 rounded-md object-cover">
                    <div class="flex-1">
                        <h4 class="font-bold">${item.nombre}</h4>
                        <p class="text-sm text-gray-400">${detalles}</p>
                        <p class="text-[var(--secondary)] font-semibold">$${item.precioFinal.toFixed(
                          2
                        )}</p>
                    </div>
                    <button class="remove-from-cart-btn text-gray-500 hover:text-red-500 transition-colors" data-id="${
                      item.cartItemId
                    }"><ion-icon name="trash-outline" class="text-2xl"></ion-icon></button>
                </div>`;
            cartItemsContainer.innerHTML += itemHTML;
          });
        }

        function actualizarTotal() {
          const total = carrito.reduce((acc, item) => acc + item.precioFinal, 0);
          cartTotal.textContent = `$${total.toFixed(2)}`;
        }

        function actualizarContadorCarrito() {
          const totalItems = carrito.length;
          cartCounter.textContent = totalItems;
          if (totalItems > 0 && document.activeElement.closest(".open-options-btn")) {
            cartCounter.classList.add("cart-pop");
            setTimeout(() => cartCounter.classList.remove("cart-pop"), 300);
          }
        }

        function enviarPedidoWhatsApp() {
          if (carrito.length === 0) return;
          let mensaje =
            "¡Hola Galaxy Sport! 👋 Quiero hacer un pedido con los siguientes productos:\n\n";
          carrito.forEach((item) => {
            let detalleItem = `*- ${item.nombre}*\n`;
            detalleItem += `  Talla: ${item.talla}\n`;
            if (item.nombreJugador && item.numeroJugador) {
              detalleItem += `  Personalización: ${item.nombreJugador}, #${item.numeroJugador}\n`;
            }
            detalleItem += `  Precio: $${item.precioFinal.toFixed(2)}\n\n`;
            mensaje += detalleItem;
          });
          const total = carrito.reduce((acc, item) => acc + item.precioFinal, 0);
          mensaje += `*Total a pagar: $${total.toFixed(
            2
          )}*\n\nEspero su respuesta para coordinar. ¡Gracias!`;
          const urlWhatsApp = `https://wa.me/${tuNumeroDeWhatsApp}?text=${encodeURIComponent(
            mensaje
          )}`;
          window.open(urlWhatsApp, "_blank");
        }

        // --- EVENT LISTENERS ---
        productGrid.addEventListener("click", (e) => {
          if (e.target.classList.contains("open-options-btn")) {
            abrirModalOpciones(parseInt(e.target.dataset.id));
          }
        });

        optionsForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const productId = parseInt(e.target.dataset.productId);
          const productoBase = productos.find((p) => p.id === productId);
          const nombreJugador = playerNameInput.value.trim().toUpperCase();
          const numeroJugador = playerNumberInput.value.trim();
          let precioFinal = productoBase.precio;
          if (productoBase.personalizable && (nombreJugador || numeroJugador)) {
            precioFinal += productoBase.costoPersonalizacion;
          }
          const tallaSeleccionada = document.querySelector('input[name="talla"]:checked').value;
          const itemParaCarrito = {
            ...productoBase,
            cartItemId: Date.now(),
            talla: tallaSeleccionada,
            nombreJugador,
            numeroJugador,
            precioFinal,
          };
          agregarAlCarrito(itemParaCarrito);
          cerrarModalOpciones();
        });

        optionsGallery.addEventListener("click", (e) => {
          if (e.target.tagName === "IMG" && e.target.dataset.fullSrc) {
            optionsImage.src = e.target.dataset.fullSrc;
            [...e.target.parentElement.children].forEach((child) =>
              child.classList.remove("border-[var(--primary)]")
            );
            e.target.classList.add("border-[var(--primary)]");
          }
        });

        cartItemsContainer.addEventListener("click", (e) => {
          const removeBtn = e.target.closest(".remove-from-cart-btn");
          if (removeBtn) {
            quitarDelCarrito(parseInt(removeBtn.dataset.id));
          }
          const shopBtn = e.target.closest("#close-and-shop");
          if (shopBtn) {
            cerrarModalCarrito();
          }
        });

        categoryFilters.addEventListener("click", (e) => {
          if (e.target.tagName === "BUTTON") {
            const activeBtn = document.querySelector(".category-btn.active");
            if (activeBtn) activeBtn.classList.remove("active");
            e.target.classList.add("active");

            const busquedaActual = searchInput.value.trim();
            renderizarProductos(e.target.dataset.category, busquedaActual);
          }
        });

        searchInput.addEventListener("input", () => {
          const categoriaActiva =
            document.querySelector(".category-btn.active")?.dataset.category || "all";
          const busquedaActual = searchInput.value.trim();
          renderizarProductos(categoriaActiva, busquedaActual);
        });

        function abrirModalCarrito() {
          cartModal.classList.remove("opacity-0", "pointer-events-none");
          document.getElementById("cart-modal-content").classList.remove("scale-95");
        }

        function cerrarModalCarrito() {
          cartModal.classList.add("opacity-0", "pointer-events-none");
          document.getElementById("cart-modal-content").classList.add("scale-95");
        }

        openCartButton.addEventListener("click", abrirModalCarrito);
        closeCartButton.addEventListener("click", cerrarModalCarrito);
        closeOptionsButton.addEventListener("click", cerrarModalOpciones);
        whatsappButton.addEventListener("click", enviarPedidoWhatsApp);

        cartModal.addEventListener("click", (e) => {
          if (e.target === cartModal) {
            cerrarModalCarrito();
          }
        });
        optionsModal.addEventListener("click", (e) => {
          if (e.target === optionsModal) cerrarModalOpciones();
        });

        // --- INICIALIZACIÓN ---
        AOS.init({ duration: 800, once: true, offset: 50 });
        cargarCarritoDesdeStorage();
        renderizarFiltros();
        renderizarProductos();
      });
    </script>
  </body>
</html>
